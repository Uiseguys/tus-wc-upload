{"moduleFile":{"sourceFilePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.tsx","localImports":[],"externalImports":["@stencil/core","@uppy/core","@uppy/dashboard","@uppy/tus","@uppy/xhr-upload","module","tus-js-client"],"potentialCmpRefs":[],"cmpMeta":{"tagNameMeta":"cwc-upload-item","stylesMeta":{"$":{"externalStyles":[{"absolutePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.css","cmpRelativePath":"file-uploader.css","originalComponentPath":"file-uploader.css"}]}},"assetsDirsMeta":[],"hostMeta":{},"dependencies":[],"jsdoc":{"name":"AppProfile","documentation":"","type":"typeof AppProfile"},"encapsulationMeta":0,"componentClass":"AppProfile","membersMeta":{"refreshState":{"memberType":16},"filesList":{"memberType":16},"uploadsList":{"memberType":16},"error":{"memberType":16},"fileProvided":{"memberType":1,"attribName":"file-provided","attribType":{"text":"any[]","optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":0,"jsdoc":{"name":"fileProvided","documentation":"","type":"any[]"},"watchCallbacks":["watchFiles"]},"endpoint":{"memberType":1,"attribName":"endpoint","attribType":{"text":"String","optional":false,"typeReferences":{"String":{"referenceLocation":"global"}}},"reflectToAttrib":false,"propType":0,"jsdoc":{"name":"endpoint","documentation":"","type":"String"}}},"eventsMeta":[],"listenersMeta":[]},"hasSlot":false,"hasSvg":false,"jsFilePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.js"},"jsText":"export class AppProfile {\r\n    constructor() {\r\n        this.fileProvided = [];\r\n        this.endpoint = \"\";\r\n        this.refreshState = false;\r\n        this.filesList = [];\r\n        this.uploadsList = [];\r\n        this.error = [];\r\n    }\r\n    watchFiles(newValue) {\r\n        this.init(newValue);\r\n    }\r\n    componentDidLoad() {\r\n        setInterval(() => { this.progressTracker(); }, 5000);\r\n    }\r\n    init(inputFiles) {\r\n        for (let i = 0; i < inputFiles.length; i++) {\r\n            var file = inputFiles[i];\r\n            file['pause'] = false;\r\n            file['uploaded'] = false;\r\n            file['progress'] = { bytesUploaded: 0, bytesTotal: file.size, percentage: \"0%\" };\r\n            file['id'] = Date.now() + file.size;\r\n            this.filesList = [...this.filesList, file];\r\n            let self = this;\r\n            let upload = new tus.Upload(file, {\r\n                endpoint: this.endpoint,\r\n                retryDelays: [0, 1000, 3000, 5000],\r\n                metadata: {\r\n                    filename: file.name,\r\n                    filetype: file.type\r\n                },\r\n                onError: function (error) {\r\n                    self.errorHandler(error);\r\n                },\r\n                onProgress: function (bytesUploaded, bytesTotal) {\r\n                    var percentage = (Math.round((bytesUploaded * 100) / bytesTotal) + \"%\").toString();\r\n                    self.progressHandler(file, percentage);\r\n                },\r\n                onSuccess: function () {\r\n                    self.uploadSuccess(file);\r\n                    console.log(file);\r\n                }\r\n            });\r\n            this.uploadsList = [...this.uploadsList, upload];\r\n            // this.uploadsList[this.uploadsList.length - 1].start()\r\n            // this.uploadsList = [...this.uploadsList, upload];\r\n            upload.start();\r\n        }\r\n    }\r\n    progressTracker() {\r\n        for (let i = 0; i < this.filesList.length; i++) {\r\n            if (this.filesList[i].uploaded == false) {\r\n                this.uploadsList[i].onProgress((byteuploaded, total) => {\r\n                    console.log(i + \" ff\" + byteuploaded);\r\n                });\r\n            }\r\n        }\r\n    }\r\n    progressHandler(file, percentage) {\r\n        var indexs = this.filesList.findIndex(x => x.id == file.id);\r\n        if (indexs > -1) {\r\n            this.filesList[indexs].progress.percentage = percentage;\r\n            this.refreshState = !this.refreshState;\r\n        }\r\n    }\r\n    uploadSuccess(file) {\r\n        let index = this.filesList.findIndex(x => x.id == file.id);\r\n        if (index > -1) {\r\n            this.filesList[index].uploaded = true;\r\n            this.refreshState = !this.refreshState;\r\n        }\r\n    }\r\n    errorHandler(error) {\r\n        this.refreshState = !this.refreshState;\r\n        this.error = [...this.error, error.message];\r\n        let timer;\r\n        clearInterval(timer);\r\n        timer = setInterval(() => {\r\n            this.error = [];\r\n        }, 3000);\r\n        console.log(\"Failed because: \" + error);\r\n    }\r\n    resumeAbortUploading(file, i) {\r\n        if (file) { }\r\n        this.filesList[i].pause = !this.filesList[i].pause;\r\n        if (this.filesList[i].pause == true) {\r\n            this.uploadsList[i].abort();\r\n        }\r\n        else {\r\n            this.uploadsList[i].start();\r\n        }\r\n        this.refreshState = !this.refreshState;\r\n    }\r\n    cancelUpload(i) {\r\n        this.uploadsList[i].abort();\r\n        this.uploadsList.splice(i, 1);\r\n        this.filesList.splice(i, 1);\r\n        this.refreshState = !this.refreshState;\r\n    }\r\n    render() {\r\n        var resumeButton = \"<img src='/assets/icon/play-button.svg' >\";\r\n        var pauseButton = \"<img src='/assets/icon/pause-button.svg'/>\";\r\n        var check = \"<img src='/assets/icon/checked.svg' />\";\r\n        return (h(\"div\", { class: \"st_container\" },\r\n            h(\"div\", { class: \"st_content_align_center\" },\r\n                h(\"div\", { class: \"st_uploaded_file st_w_100 st_text-center\" },\r\n                    h(\"div\", { class: \"uploaded_images\" },\r\n                        h(\"div\", { class: \"st_row\" }, this.filesList.map((file, i) => h(\"div\", { class: \"st_wid_20\" },\r\n                            h(\"div\", { class: \"st_allContent\" },\r\n                                h(\"div\", { class: \"st_image\" },\r\n                                    h(\"img\", { src: \"http://ishort.co/wp-content/uploads/free-images-of-nature-nature-images-pixabay-download-free-pictures.jpg\", class: \"st_wid_100\" })),\r\n                                h(\"p\", { class: \"upload-name\" },\r\n                                    \"  \",\r\n                                    file.name.slice(0, 15)),\r\n                                h(\"div\", { class: \"st_barVDOcancel st_w_100\" },\r\n                                    h(\"div\", { class: \"st_row st_bg\" },\r\n                                        h(\"div\", { class: \"st_wid_70\" },\r\n                                            h(\"div\", { class: \"st_progress-bar\" },\r\n                                                h(\"div\", { class: \"st_loaded\", style: { width: (file.progress.percentage) } }))),\r\n                                        h(\"div\", { class: \"st_wid_15\" }, file.uploaded == true ?\r\n                                            h(\"a\", { class: \"st_closeBtn\", innerHTML: check })\r\n                                            : file.pause == true ?\r\n                                                h(\"a\", { class: \"st_closeBtn\", innerHTML: resumeButton, onClick: () => this.resumeAbortUploading(file, i) }, \" \")\r\n                                                : h(\"a\", { class: \"st_closeBtn\", innerHTML: pauseButton, onClick: () => this.resumeAbortUploading(file, i) })),\r\n                                        h(\"div\", { class: \"st_wid_15\" },\r\n                                            h(\"a\", { class: \"st_closeBtn\" },\r\n                                                h(\"img\", { src: \"/assets/icon/cancel.svg\", onClick: () => this.cancelUpload(i) }))))))))))))));\r\n    }\r\n    static get is() { return \"cwc-upload-item\"; }\r\n    static get properties() { return {\r\n        \"endpoint\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"endpoint\"\r\n        },\r\n        \"error\": {\r\n            \"state\": true\r\n        },\r\n        \"fileProvided\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"file-provided\",\r\n            \"watchCallbacks\": [\"watchFiles\"]\r\n        },\r\n        \"filesList\": {\r\n            \"state\": true\r\n        },\r\n        \"refreshState\": {\r\n            \"state\": true\r\n        },\r\n        \"uploadsList\": {\r\n            \"state\": true\r\n        }\r\n    }; }\r\n    static get style() { return \"/**style-placeholder:cwc-upload-item:**/\"; }\r\n}\r\n"}