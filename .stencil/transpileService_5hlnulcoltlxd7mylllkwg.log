{"moduleFile":{"sourceFilePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.tsx","localImports":[],"externalImports":["@stencil/core","@uppy/core","@uppy/dashboard","@uppy/tus","@uppy/xhr-upload","module","tus-js-client"],"potentialCmpRefs":[],"cmpMeta":{"tagNameMeta":"cwc-upload-item","stylesMeta":{"$":{"externalStyles":[{"absolutePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.css","cmpRelativePath":"file-uploader.css","originalComponentPath":"file-uploader.css"}]}},"assetsDirsMeta":[],"hostMeta":{},"dependencies":[],"jsdoc":{"name":"AppProfile","documentation":"","type":"typeof AppProfile"},"encapsulationMeta":0,"componentClass":"AppProfile","membersMeta":{"filesList":{"memberType":16},"uploadsList":{"memberType":16},"error":{"memberType":16},"fileProvided":{"memberType":1,"attribName":"file-provided","attribType":{"text":"any[]","optional":false,"typeReferences":{}},"reflectToAttrib":false,"propType":0,"jsdoc":{"name":"fileProvided","documentation":"","type":"any[]"},"watchCallbacks":["watchFiles"]},"endpoint":{"memberType":1,"attribName":"endpoint","attribType":{"text":"String","optional":false,"typeReferences":{"String":{"referenceLocation":"global"}}},"reflectToAttrib":false,"propType":0,"jsdoc":{"name":"endpoint","documentation":"","type":"String"}}},"eventsMeta":[],"listenersMeta":[]},"hasSlot":false,"hasSvg":false,"jsFilePath":"/home/users/ajayveer/Music/stencil/my-app/src/components/file-uploader/file-uploader.js"},"jsText":"export class AppProfile {\r\n    constructor() {\r\n        this.fileProvided = [];\r\n        this.endpoint = \"\";\r\n        this.filesList = [];\r\n        this.uploadsList = [];\r\n        this.error = [];\r\n    }\r\n    watchFiles(newValue, oldValue) {\r\n        console.log(\"Watcher\");\r\n        console.log(newValue);\r\n        this.init(newValue);\r\n        console.log(oldValue);\r\n    }\r\n    componentDidLoad() {\r\n        this.init([]);\r\n    }\r\n    init(inputFiles) {\r\n        let self = this;\r\n        for (let i = 0; i < inputFiles.length; i++) {\r\n            var file = inputFiles[i];\r\n            var opt = { id: Date.now() + file.name, pause: false, uploaded: false, progress: { bytesUploaded: 0, bytesTotal: file.size, percentage: \"0%\" } };\r\n            // file['pause'] = false;\r\n            // file['uploaded'] = false;\r\n            // file['progress'] = { bytesUploaded: 0, bytesTotal: file.size, percentage: \"0%\" };\r\n            // file['id'] = Date.now() + file.size;\r\n            let obj = { file: file, options: opt };\r\n            this.filesList = [...this.filesList, obj];\r\n            let upload = new tus.Upload(file, {\r\n                endpoint: this.endpoint,\r\n                retryDelays: [0, 1000, 3000, 5000],\r\n                metadata: {\r\n                    filename: file.name,\r\n                    filetype: file.type\r\n                },\r\n                onError: function (error) {\r\n                    self.error = [...self.error, error.message];\r\n                    upload.start();\r\n                    console.log(\"Failed because: \" + error);\r\n                },\r\n                onProgress: function (bytesUploaded, bytesTotal) {\r\n                    console.log(bytesUploaded);\r\n                    var percentage = (Math.round((bytesUploaded * 100) / bytesTotal) + \"%\").toString();\r\n                    var indexs = self.filesList.findIndex(x => x.options.id == obj.options.id);\r\n                    console.log(indexs);\r\n                    console.log(percentage);\r\n                    if (indexs > -1) {\r\n                        self.filesList[indexs].options.progress.bytesUploaded = bytesUploaded;\r\n                        self.filesList[indexs].options.progress.percentage = percentage;\r\n                        console.log(self.filesList);\r\n                    }\r\n                },\r\n                onSuccess: function () {\r\n                    console.log(\"Succedd\");\r\n                    let index = self.filesList.findIndex(x => x.options.id == file.options.id);\r\n                    if (index > -1) {\r\n                        self.filesList[index].options.uploaded = true;\r\n                    }\r\n                }\r\n            });\r\n            this.uploadsList = [...this.uploadsList, upload];\r\n            upload.start();\r\n            // Start the upload\r\n            // upload.abort()\r\n        }\r\n        setTimeout(() => {\r\n            this.filesList[0].options.progress.percentage = \"50%\";\r\n        }, 2000);\r\n    }\r\n    uploadSuccess() {\r\n        // this.uppy.on('upload-success', (file, uploadURL) => {\r\n        //   console.log(file)\r\n        //   let index = this.files.findIndex(x => x.id == file.id);\r\n        //   if (index > -1) {\r\n        //     this.files[index].uploaded = true;\r\n        //   }\r\n        //   if (uploadURL.file.type == \"image/png\" ||\r\n        //     uploadURL.file.type == \"image/jpg\" ||\r\n        //     uploadURL.file.type == \"image/jpeg\" ||\r\n        //     uploadURL.file.type == \"image/svg\") {\r\n        //     var img = document.createElement(\"img\")\r\n        //     img.src = uploadURL.url;\r\n        //     let body = document.getElementById(\"image-list\")\r\n        //     body.appendChild(img)\r\n        //   }\r\n        // })\r\n    }\r\n    errorHandler() {\r\n        // let timer;\r\n        // this.uppy.on('info-visible', () => {\r\n        //   const info = this.uppy.getState().info;\r\n        //   clearInterval(timer)\r\n        //   this.error = [...this.error, info.message]\r\n        // })\r\n        // this.uppy.on('upload-error', (error) => {\r\n        //   clearInterval(timer)\r\n        //   this.error = [...this.error, error]\r\n        // })\r\n        // timer = setInterval(() => {\r\n        //   this.error = [];\r\n        // }, 3000)\r\n    }\r\n    playPauseDownloading(file, i) {\r\n        if (file) { }\r\n        this.filesList[i].pause = !this.filesList[i].pause;\r\n        if (this.filesList[i].pause == true) {\r\n            this.uploadsList[i].abort();\r\n        }\r\n        else {\r\n            this.uploadsList[i].start();\r\n        }\r\n    }\r\n    render() {\r\n        var resumeButton = \"<img src='/assets/icon/play.png' >\";\r\n        var pauseButton = \"<img src='/assets/icon/pause-512.png'/>\";\r\n        var check = \"<img src='/assets/icon/checkmark-png-28.png' />\";\r\n        return (h(\"div\", { class: \"cwc-upload-item\" },\r\n            h(\"h4\", null, \"Uploader\"),\r\n            this.filesList.map((file, i) => h(\"div\", { class: \"progress-list\" },\r\n                h(\"div\", { class: \"file-name\" }, file.file.name),\r\n                h(\"div\", { id: \"myProgress\" },\r\n                    h(\"div\", { style: { width: file.options.progress.percentage } })),\r\n                file.uploaded ?\r\n                    h(\"div\", { class: \"progress-footer\" },\r\n                        h(\"button\", { class: \"play-pause-btn\", innerHTML: check }),\r\n                        h(\"span\", null, \"Complete\"))\r\n                    :\r\n                        h(\"div\", { class: \"progress-footer\" },\r\n                            h(\"button\", { class: \"play-pause-btn\", onClick: () => this.playPauseDownloading(file, i), innerHTML: file.options.pause == true ? resumeButton : pauseButton }),\r\n                            h(\"span\", null,\r\n                                \" \",\r\n                                file.options.pause == true ? \"Paused\" : \"Uploading\",\r\n                                \" : \",\r\n                                file.options.progress.percentage)))),\r\n            h(\"ul\", null, this.error.map((err) => h(\"li\", null, err))),\r\n            h(\"div\", { id: \"image-list\" })));\r\n    }\r\n    static get is() { return \"cwc-upload-item\"; }\r\n    static get properties() { return {\r\n        \"endpoint\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"endpoint\"\r\n        },\r\n        \"error\": {\r\n            \"state\": true\r\n        },\r\n        \"fileProvided\": {\r\n            \"type\": \"Any\",\r\n            \"attr\": \"file-provided\",\r\n            \"watchCallbacks\": [\"watchFiles\"]\r\n        },\r\n        \"filesList\": {\r\n            \"state\": true\r\n        },\r\n        \"uploadsList\": {\r\n            \"state\": true\r\n        }\r\n    }; }\r\n    static get style() { return \"/**style-placeholder:cwc-upload-item:**/\"; }\r\n}\r\n"}